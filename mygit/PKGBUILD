pkgname=mygit
pkgver=0.1.0
pkgrel=1
pkgdesc="Simple self-hosted git server, written in Rust"
arch=('x86_64' 'armv7h')
url="https://git.alexwennerberg.com/mygit"
license=("AGPL-3.0")
makedepends=("git" "cargo")
provides=(${pkgname})
conflicts=(${pkgname})
source=("https://github.com/alexwennerberg/${pkgname}/archive/refs/tags/v${pkgver}.tar.gz"
	"${pkgname}.service")
sha256sums=(
	"SKIP"
	"SKIP")

build() {
	cd "${srcdir}/${pkgname}-${pkgver}"

	sed -i 's#clone_base = "https://git.alexwennerberg.com"#clone_base = "https://git.gavrois.fr"#g'        "${srcdir}/${pkgname}-${pkgver}/mygit.toml"
	sed -i 's#projectroot = "repos"#projectroot = "/srv/git/gavrois"#g'                                     "${srcdir}/${pkgname}-${pkgver}/mygit.toml"

	cargo build --release --target-dir=target
}

package() {
	install -Dm644 "${srcdir}/mygit.service"					"${pkgdir}/usr/lib/systemd/system/mygit.service"

	install -Dm755 "${srcdir}/${pkgname}-${pkgver}/target/release/${pkgname}"	"${pkgdir}/usr/bin/${pkgname}"
	install -Dm755 "${srcdir}/${pkgname}-${pkgver}/mygit.toml"			"${pkgdir}/etc/mygit.toml"
}
